apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: restrict-image-registries
  annotations:
    policies.kyverno.io/title: Restrict Image Registries
    policies.kyverno.io/category: Sample
    policies.kyverno.io/severity: medium
    policies.kyverno.io/subject: Pod
    policies.kyverno.io/minversion: 1.3.0
    policies.kyverno.io/description: >-
      This policy ensures that container images are signed with Cosign before being allowed to be deployed.
spec:
  validationFailureAction: enforce
  background: false
  rules:
    - name: verify-images
      match:
        any:
        - resources:
            kinds:
              - Pod
      verifyImages:
        - imageReferences:
            - "*"
          attestors:
            - entries:
                - keyless:
                    url: https://fulcio.sigstore.dev
                    identities:
                      - issuer: https://accounts.google.com
                        subject: "*@example.com"